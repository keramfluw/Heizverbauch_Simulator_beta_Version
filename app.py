[... code from above omitted for brevity ...]
